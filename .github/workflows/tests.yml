name: Tests

on:
    - push
    - pull_request

jobs:
    test:
        runs-on: ${{matrix.os}}
        strategy:
            fail-fast: false
            matrix:
                os: [ubuntu-latest, windows-latest]
                python-version: ['3.9', '3.10', '3.11']
                include:
                    - os: ubuntu-latest
                      python-version: '3.9'
                      toxenv: py39
                    - os: ubuntu-latest
                      python-version: '3.10'
                      toxenv: py310
                    - os: ubuntu-latest
                      python-version: '3.11'
                      toxenv: py311
                    - os: windows-latest
                      python-version: '3.9'
                      toxenv: py39
                    - os: windows-latest
                      python-version: '3.10'
                      toxenv: py310
                    - os: windows-latest
                      python-version: '3.11'
                      toxenv: py311
        steps:
            - uses: actions/checkout@v4
            - name: Set up Python ${{matrix.python-version}}
              uses: actions/setup-python@v4
              with:
                python-version: ${{matrix.python-version}}
            - name: Install dependencies
              run: |
                python -m pip install --upgrade pip virtualenv setuptools
                pip install tox tox-gh-actions
                pip install -r requirements.txt
            - name: Test with tox
              run: pip install tox
            - name: run tox
              run: tox
              env:
                TOXENV: ${{ matrix.toxenv }}

            - name: Code Coverage Report
              uses: irongut/CodeCoverageSummary@v1.3.0
              with:
                filename: coverage/**/coverage.cobertura.xml
                badge: true
                fail_below_min: true
                format: markdown
                hide_branch_rate: false
                hide_complexity: true
                indicators: true
                output: both
                thresholds: '60 80'
          

            